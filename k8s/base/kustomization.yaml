apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: whispr-prod

resources:
  - namespace.yaml
  - serviceaccount.yaml
  - deployment.yaml
  - service.yaml
  - hpa.yaml
  - pdb.yaml
  - virtualservice.yaml
  - destinationrule.yaml

configMapGenerator:
  - name: messaging-service-config
    literals:
      - MIX_ENV=prod
      - PHX_SERVER=true
      - PORT=4000
      - GRPC_PORT=4001
      - LOG_LEVEL=info

# TODO: Use SealedSecrets or External Secrets Operator instead of committing secrets
# See: https://github.com/bitnami-labs/sealed-secrets
# Or: https://external-secrets.io/
#
# secretGenerator:
#   - name: messaging-service-secrets
#     literals:
#       - DATABASE_URL=postgresql://whispr:PASSWORD@postgresql.whispr-prod.svc.cluster.local:5432/whispr_messaging
#       - REDIS_URL=redis://redis-master.whispr-prod.svc.cluster.local:6379/0
#       - SECRET_KEY_BASE=GENERATE_WITH_mix_phx_gen_secret

commonLabels:
  app.kubernetes.io/name: messaging-service
  app.kubernetes.io/part-of: whispr
